@model kurssienhallinta.Models.ViewModels.TeacherScheduleViewModel

<h2>Viikkoaikataulu</h2>

<div style="display: flex; gap: 20px; padding: 20px;">
    <!-- Aika vasemmalla, käyttää alhaalla olevaa GetAllTimeSlots-apufunktiota luodakseen ajat -->
    <div>
        <div style="font-weight: bold; margin-bottom: 40px;">Time</div>
        @foreach (var timeSlot in GetAllTimeSlots())
        {
            <div style="height: 80px; display: flex; align-items: center; border-bottom: 1px solid #ccc;">
                @timeSlot.ToString(@"hh\:mm")
            </div>
        }
    </div>

    <!-- Käytä GetAllDays palauttaakseen Maanantai – Perjantai -->
    @foreach (var day in GetAllDays())
    {
        <div style="min-width: 150px;">
            <div style="font-weight: bold; margin-bottom: 40px; text-align: center;">@day</div>

            <!-- Käy läpi GetAllTimeSlots Maanantai – Perjantai kloajat 08:00-16:00 -->
            @foreach (var timeSlot in GetAllTimeSlots())
            {
                var course = Model.WeeklySchedule.ContainsKey(day)
                ? Model.WeeklySchedule[day].FirstOrDefault(c => c.Start_time == timeSlot)
                : null;

                <!-- Tarkista onko jo varattu, ei voi tulla päällekäisyyksiä -->
                var isAlreadySpanned = Model.WeeklySchedule.ContainsKey(day)
                ? Model.WeeklySchedule[day].Any(c => c.Start_time < timeSlot && c.End_time > timeSlot)
                : false;

                @if (!isAlreadySpanned)
                {
                    <!-- Laske kurssin alue aikataulusta perustuen kestoon -->
                    @if (course != null)
                    {
                        var hours = (int)(course.End_time - course.Start_time).TotalHours;
                        var height = hours * 80;

                        <div
                            style="height: @(height)px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 8px; border-radius: 4px; margin-bottom: 5px; display: flex; align-items: center; justify-content: center; text-align: center; font-size: 12px;">
                            <div>
                                <strong>@course.Name</strong>
                                <p>@course.Room?.Name</p>
                                <p>@course.Start_time.ToString(@"hh\:mm")-@course.End_time.ToString(@"hh\:mm")</p>
                            </div>
                        </div>
                    }
                    else
                    {
                        <div style="height: 80px; border-bottom: 1px solid #eee;"></div>
                    }
                }
            }
        </div>
    }
</div>

@functions {
    private List<string> GetAllDays()
    {
        return new List<string> { "Monday", "Tuesday", "Wednesday", "Thursday", "Friday" };
    }

    private List<TimeSpan> GetAllTimeSlots()
    {
        var slots = new List<TimeSpan>();
        for (int hour = 8; hour <= 15; hour++)
            slots.Add(new TimeSpan(hour, 0, 0));
        return slots;
    }
}